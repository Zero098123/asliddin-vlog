{% extends "base.html" %}
{% block title %}{{ post.title }}{% endblock %}

{% block content %}
<div class="container" style="max-width: 800px; margin: 4rem auto;">

  <!-- Post Title & Meta -->
  <h1 style="font-size: 2.8rem; margin-bottom: 0.5rem; color: var(--text);">
    {{ post.title }}
  </h1>
  <div style="color: var(--text-light); margin-bottom: 2rem; font-size: 1rem;">
    <span>{{ post.date_posted.strftime('%B %d, %Y') }}</span>
    <span>•</span>
    <span>by <strong>{{ post.author.username }}</strong></span>
    {% if post.author.is_admin %}
      <span style="background:#2563eb; color:white; padding:2px 8px; border-radius:12px; font-size:0.8rem;">Admin</span>
    {% endif %}
  </div>

  <!-- Post Content -->
  <div style="font-size: 1.2rem; line-height: 1.8; color: var(--text); background:var(--card-bg); padding:2rem; border-radius:16px; box-shadow:var(--shadow);">
    {{ post.content | safe }} <!-- Use |safe if you write Markdown later -->
  </div>

  <hr style="margin: 3rem 0; border: 0; border-top: 1px solid var(--border);">

  <!-- Comments Section -->
  <h2 style="margin-bottom: 1.5rem;">Comments ({{ post.comments|length }})</h2>

  <!-- Comment Form (only for logged-in users) -->
  {% if current_user.is_authenticated %}
    <form method="post" style="margin-bottom: 3rem;">
      <textarea name="content" rows="4" required placeholder="Write your thoughts..." 
                style="width:100%; padding:1rem; border-radius:12px; border:1px solid var(--border); font-family:inherit; resize:vertical;"></textarea>
      <button type="submit" style="margin-top:1rem; padding:0.8rem 1.8rem; background:#2563eb; color:white; border:none; border-radius:8px; cursor:pointer;">
        Post Comment
      </button>
    </form>
  {% else %}
    <p style="color:var(--text-light); font-style:italic;">
      <a href="{{ url_for('routes.login') }}" style="color:#2563eb;">Log in</a> to leave a comment.
    </p>
  {% endif %}

  <!-- List of Comments -->
  <div class="comments-list">
    {% for comment in post.comments|reverse %}
      <div style="background:var(--card-bg); padding:1.5rem; border-radius:12px; margin-bottom:1rem; box-shadow:var(--shadow);">
        <div style="display:flex; justify-content:space-between; margin-bottom:0.5rem;">
          <strong>{{ comment.author.username }}</strong>
          <small style="color:var(--text-light);">
            {{ comment.date_posted.strftime('%b %d, %Y at %H:%M') }}
          </small>
        </div>
        <p style="margin:0; white-space: pre-wrap;">{{ comment.content }}</p>

        <!-- Delete button for comment owner or admin -->
        {% if current_user.is_authenticated and (current_user == comment.author or current_user.is_admin) %}
          <a href="{{ url_for('routes.delete_comment', comment_id=comment.id) }}" 
             style="color:red; font-size:0.9rem; margin-top:0.5rem; display:inline-block;"
             onclick="return confirm('Delete this comment?')">
            Delete
          </a>
        {% endif %}
      </div>
    {% endfor %}

    {% if post.comments|length == 0 %}
      <p style="color:var(--text-light); text-align:center; font-style:italic;">
        No comments yet — be the first!
      </p>
    {% endif %}
  </div>

  <div style="margin-top: 3rem; text-align: center;">
    <a href="{{ url_for('routes.user') }}" style="color:#2563eb;">← Back to all posts</a>
  </div>

</div>
{% endblock %}